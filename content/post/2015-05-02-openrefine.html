---
title: Cleaning Patent Data with Open Refine
author: Paul Oldham
date: '2015-05-02'
slug: openrefine-patent-cleaning
categories:
  - Patents
tags: [open refine, name cleaning]
---



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Cleaning patent data is one of the most challenging and time consuming tasks involved in patent analysis. In this chapter we will cover.</p>
<ol style="list-style-type: decimal">
<li>Basic data cleaning using Open Refine</li>
<li>Separating a patent dataset on applicant names and cleaning the names.</li>
<li>Exporting a dataset from Open Refine at different stages in the cleaning process.</li>
</ol>
<p><a href="http://openrefine.org">Open Refine</a> is an open source tool for working with all types of messy data. It started life as Google Refine but has since migrated to Open Refine. It is a programme that runs in a browser on your computer but does not require an internet connection. It is a key tool in the open source patent analysis tool kit and includes extensions and the use of custom code for particular custom tasks. In this article we will cover some of the basics that are most relevant to patent analysis and then move on to more detailed work to clean patent applicant names.</p>
<p>The reason that patent analysts should use Open Refine is that it is the easiest to use and most efficient free tool for cleaning patent data without programming knowledge. It is far superior to attempting the same cleaning tasks in Excel or Open Office. The terminology that is used can take some getting used to, but it is possible to develop efficient workflows for cleaning and reshaping data using Open Refine and to create and reuse custom codes needed for specific tasks.</p>
<p>In this chapter we use Open Refine to clean up a raw dataset from WIPO Patentscope containing nearly 10,000 raw records that make some kind of reference to the word <code>pizza</code> in the whole text. To follow this chapter using one of our training sets, download it from the Github repository <a href="https://github.com/poldham/opensource-patent-analytics/blob/master/2_datasets/pizza_medium/pizza_medium.csv?raw=true">here</a> or use your own dataset.</p>
</div>
<div id="install-open-refine" class="section level2">
<h2>Install Open Refine</h2>
<p>To install Open Refine visit the Open Refine <a href="http://openrefine.org">website</a> and <a href="http://openrefine.org/download.html">download</a> the software for your operating system:</p>
<p><img src="/images/openrefine/OpenRefine_front.png" width="800px" style="display: block; margin: auto;" /></p>
<p>From the download page select your operating system. Note the extensions towards the bottom of the page for future reference.</p>
<p><img src="/images/openrefine/OpenRefine-download.png" width="800px" style="display: block; margin: auto;" /></p>
<p>At the time of writing, when you download Open Refine it actually downloads and installs as Google Refine (reflecting its history) and so that is the application you will need to look for and open.</p>
</div>
<div id="create-a-project" class="section level2">
<h2>Create a Project</h2>
<p>We will use the Patentscope Pizza Medium file that can be downloaded from the repository <a href="https://github.com/poldham/opensource-patent-analytics/blob/master/2_datasets/pizza_medium/pizza_medium.csv?raw=true">here</a>.</p>
<p><img src="/images/openrefine/create_project.png" width="800px" style="display: block; margin: auto;" /></p>
<p>The file will load and then attempt to guess the column separator. Choose <code>.csv.</code> Note that a wide range of files can be imported and that there are additional options such as storing blank cells as nulls that are selected by default. In the dataset that you will load we have prefilled blank cells with <code>NA</code> values to avoid potential problems using fill down in Open Refine discussed below.</p>
<p><img src="/images/openrefine/create_project2.png" width="800px" style="display: block; margin: auto;" /></p>
<p>Click <code>create project</code> in the top right of the bar as the next step.</p>
</div>
<div id="open-refine-basics" class="section level2">
<h2>Open Refine Basics</h2>
<p>A few basic features of Open Refine will soon have you working smoothly. Here is a quick tour.</p>
<div id="open-refine-runs-in-a-browser" class="section level3">
<h3>Open Refine runs in a browser</h3>
<p>Open Refine is an application that lives on your computer but runs in a browser. However, it does not require an internet connection and it does not lose your work if you close the browser.</p>
</div>
<div id="open-refine-works-on-columns." class="section level3">
<h3>Open Refine works on columns.</h3>
<p>At the top of each column is a pull down menu. Be ready to use these menus quite a lot. In particular, you will often use the <code>Edit cells &gt; Common tranforms</code> as shown below for functions such as trimming white space.</p>
<p><img src="/images/openrefine/menu_basics.png" width="800px" style="display: block; margin: auto;" /></p>
<p>Other important menus are <code>Edit column</code>, immediately below <code>Edit cells</code>, for copying or splitting columns into new columns.</p>
</div>
<div id="open-refine-works-with-facets." class="section level3">
<h3>Open Refine works with Facets.</h3>
<p>The term <code>facet</code> may initially be confusing but basically calls up a window that arranges the items in a column for inspection, sorting, and editing as we can see below. This is important because it becomes possible to identify problems and address them. It also becomes possible to apply a variety of clustering algorithms to clean up the data. Note that the size of the facet window can be adjusted by dragging the bottom of the window as we have done in this image.</p>
<p><img src="/images/openrefine/facet_menu.png" width="800px" style="display: block; margin: auto;" /></p>
<p>Hovering over an item inside the facet window brings up a small <code>edit</code> button that allows editing, such as removing <i> and </i> from the title.</p>
</div>
<div id="custom-facets" class="section level3">
<h3>Custom Facets</h3>
<p>The Facet menu below brings up a custom menu with a range of options. Selecting <code>Custom text facet</code> (see below) brings up a pop up that allows for the use of code in <a href="https://github.com/OpenRefine/OpenRefine/wiki/GREL-Functions">Open Refine Expression Language (GREL)</a> to perform tasks not covered by the main menu items. This language is quite simple and can range from short snippets for finding and replacing text to more complex functions that can be reused in future. We will demonstrate the use of this function below.</p>
<p><img src="/images/openrefine/facet_menu.png" width="800px" style="display: block; margin: auto;" /></p>
</div>
<div id="reordering-columns" class="section level3">
<h3>Reordering Columns</h3>
<p>There are two options for reordering columns. The first is to select the column menu then <code>Edit column &gt; Move column to beginning</code>. The second option, shown below, is to select the <code>All</code> drop down menu in the first column and then <code>Edit columns &gt; Re-order/remove columns</code>. In the pop up menu of fields drag the desired field to the top of the list. In this case we have dragged the <code>priority_date</code> column to the top of the list. It will now appear as the first data column.</p>
<p><img src="/images/openrefine/facet_menu.png" width="800px" style="display: block; margin: auto;" /></p>
</div>
<div id="undo-and-redo" class="section level3">
<h3>Undo and Redo</h3>
<p>Open Refine keeps track of each action and allows you to go back several steps or to the beginning. This is particularly helpful when testing whether a particular approach to cleaning (e.g. splitting columns or using a snippet of code) will meet your needs. In particular it means you can explore and test approaches while not worrying about losing your previous work.</p>
<p><img src="/images/openrefine/undo_redo.png" width="800px" style="display: block; margin: auto;" /></p>
<p>However, it can be important to plan the steps in your clean up operation to avoid problems at later stages. It may help to use a notepad as a checklist (see below). The main issue that can arise is where cleanup moves forward several steps without being fully completed in an earlier step. In some cases this can require returning to that earlier step, restarting and repeating earlier steps. As you become more familiar with Open Refine it will be easier to work out an appropriate sequence for your workflow.</p>
</div>
<div id="exporting" class="section level3">
<h3>Exporting</h3>
<p>When a clean up exercise is completed a file can be exported in a variety for formats. When working with patent data expect to create more than one file (e.g. core, applicants, inventors, IPC) to allow for analysis of aspects of the data in other tools. In this chapter we will create two files.</p>
<ol style="list-style-type: decimal">
<li>A cleaned version of the original data</li>
<li>An applicants file that separates the data by each applicant.</li>
</ol>
</div>
</div>
<div id="basic-cleaning" class="section level2">
<h2>Basic Cleaning</h2>
<p>This is the first step in working with a dataset and it will make sense to perform some basic cleaning tasks before going any further. The Pizza Medium dataset that we are working with in this article is raw in the sense that the only cleaning so far has been to remove the two empty rows at the head of the data table and to fill blank cells with NA values. The reason that it makes sense to do some basic cleaning before working with applicant, inventor or IPC data is that new datasets will be generated by this process.</p>
<p>Bear in mind that Open Refine is not the fastest programme and make sure that you allocate sufficient time for the clean up tasks and are prepared to be patient while the programme runs algorithms to process the data. Note that Open Refine will save your work and you can return to it later.</p>
<p>When working with Open Refine we will typically be working on one column at a time. However, the key <code>checklist</code> for cleaning steps is:</p>
<ol style="list-style-type: decimal">
<li>Make sure you have a back up of the original file. Creating a <code>.zip</code> file and marking it with the name <code>raw</code> can help to preserve the original.</li>
<li>Open and save a text file as a <code>code book</code> to write down the steps taken in cleaning the data (e.g. pizza_codebook.txt).</li>
<li>Regularise characters (e.g. title, lowercase, uppercase).</li>
<li>Remove leading and trailing white space.</li>
<li>Address encoding and related problems.</li>
</ol>
<p>Additional actions:</p>
<ol start="6" style="list-style-type: decimal">
<li>Transform dates</li>
<li>Access additional information and create new columns and/or rows.</li>
</ol>
<p>We will generally approach these tasks in each column and steps 6 and 7 will not always apply. The creation of a codebook will allow you to keep a note of all the steps taken to clean up a dataset. The codebook should be saved with the cleaned dataset (e.g. in the same folder) as a reference point if you need to do further work or if colleagues want to understand the transformation steps.</p>
<div id="changing-case" class="section level3">
<h3>Changing case</h3>
<p>The first column in our Patentscope pizza dataset is the publication number. To inspect what is happening and needs to be cleaned in this column we will first select the column menu and choose <code>text facet</code> from the dropdown. This will generate the side menu panel that we can see below containing the data. We can then inspect the column for problems.</p>
<p><img src="/images/openrefine/cleaning_pubno_createfacet.png" width="800px" style="display: block; margin: auto;" /></p>
<p>When we scroll down the side panel we can see that some publication numbers have a lowercase country code (in this case <code>ea</code> rather than <code>EA</code> for Eurasian Patent Organization using the <a href="http://www.wipo.int/pct/guide/en/gdvol1/annexes/annexk/ax_k.pdf">WIPO standardized country codes</a>). To address this we select the column menu <code>Edit cells &gt; Common transforms &gt; to Uppercase</code>.</p>
<p><img src="/images/openrefine/cleaning_pubno_totitlecase.png" width="800px" style="display: block; margin: auto;" /></p>
<p>If we scroll down all the publication numbers will have been converted to upper case. This will make it easier to extract the publication country codes at a later stage.</p>
</div>
<div id="regularise-case" class="section level3">
<h3>Regularise case</h3>
<p>For the other text columns it is sensible to repeat the common transformations step and select <code>to titlecase</code>. Note that this will generally work well for the title field but may not always work as well on concatenated fields such as applicants and inventor names. Repeat this step following the separation of these concatenated fields (see below on applicants). If the abstract or claims were present we would not regularise those text fields.</p>
</div>
<div id="remove-leading-and-trailing-whitespace" class="section level3">
<h3>Remove leading and trailing whitespace</h3>
<p>To remove leading and trailing white space in a column we select <code>Edit cells &gt; Common transforms &gt; Trim</code> leading and trailing white space across the columns.</p>
<p><img src="/images/openrefine/title_trailingwhitespace.png" width="800px" style="display: block; margin: auto;" /></p>
<p>Note that following the splitting of concatenated cells with multiple entries such as the applicants and the inventors fields it is a good idea to repeat the trim exercise when the process is complete to avoid potential leading white space at the start of the new name entries.</p>
</div>
<div id="add-columns" class="section level3">
<h3>Add Columns</h3>
<p>We can also add columns by selecting the column menu and <code>Edit Column &gt; Add column based on this column</code>. In this case we have added a column called publication_date.</p>
<p><img src="/images/openrefine/add_column_publicationyear.png" width="800px" style="display: block; margin: auto;" /></p>
<p>We have a number of options with respect to dates (see below). In this case we want to separate out the date information into separate columns. To do that we can use <code>Edit column &gt; Split into several columns</code>. We can also choose the separator for the split, in this case <code>.</code> and whether to keep or delete the source column. In this case we selected to retain the original column and created three new date related columns. We could as necessary then delete the date and month column if we only needed the year field.</p>
<p><img src="/images/openrefine/split_date.png" width="800px" style="display: block; margin: auto;" /></p>
<p>We can then rename these columns using the edit <code>Edit Column &gt; Rename this column</code>. Note that in this case the use of lowercase and underscores marks out columns we are creating or editing as a flag for internal use informing us that this is a column that we have created. At a later stage we will rename the original fields to mark them as original.</p>
<p><img src="/images/openrefine/rename_column.png" width="800px" style="display: block; margin: auto;" /></p>
</div>
<div id="address-encoding-and-related-problems" class="section level3">
<h3>Address Encoding and related problems</h3>
<p>The <a href="https://github.com/OpenRefine/OpenRefine/wiki/Recipes">Recipes</a> section of the documentation provides helpful tips and example code for dealing with encoding and related problems that are reproduced here:</p>
<ol style="list-style-type: decimal">
<li>corrupted characters. This arises from aggregation of data from different sources. In Patentscope the data is converted to UTF8. However, if problems are encountered select <code>Edit cells &gt; Transform</code> and try entering the following.</li>
</ol>
<pre class="r"><code>value.reinterpret(&quot;utf-8&quot;)</code></pre>
<p>It may be necessary to explore and test other sets which can be identified <a href="http://java.sun.com/j2se/1.5.0/docs/guide/intl/encoding.doc.html">here</a>.</p>
<ol start="2" style="list-style-type: decimal">
<li>Escape html/XML characters e.g. &amp;amp</li>
</ol>
<p>The most likely source of patent data is XML but to be on the safe side the following should escape (remove) html and XML code appearing in the text.</p>
<pre class="r"><code>value.unescape(&quot;html&quot;).unescape(&quot;xml&quot;)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Question marks</li>
</ol>
<p>Question marks often show up for characters that cannot be represented are a sign of encoding problems. In addition non-breaking spaces may be represented as <code>&amp;nbsp</code> (Unicode(16)). To find a Unicode value go to <code>Edit cells &gt; Transform</code> and then enter unicode(value) which will transform all the characters to unicode numbers. From there you can look up the problem.</p>
<p>A quick fix is proposed in the documentation that may work in some circumstances.</p>
<pre class="r"><code>split(escape(value,&#39;xml&#39;),&quot;&amp;#160;&quot;)[0]</code></pre>
<p>Within this particular dataset, we found that these quick tips did not work (presumably because the text had already been converted to UTF-8). However, if all else fails an alternative is to simply find and replace in Transform as in the example below.</p>
<p><img src="/images/openrefine/replace_encoding.png" width="800px" style="display: block; margin: auto;" /></p>
<p>This is not a very satisfactory solution because it requires inspection of the dataset to identify the specific character problems and then replacing the value. That will be time consuming.</p>
</div>
<div id="reformatting-dates" class="section level3">
<h3>Reformatting dates</h3>
<p>One problem we may encounter is that the standard date definition on patent documents (e.g. 21.08.2009) may not be recognised as a date field in our analysis software because dates can be ambiguous from the perspective of software code. For example, how should 08/12/2009 or 12/08/2009 be interpreted?</p>
<p>Alternatively, as in this case, the decimal points may not be correctly interpreted as signifying a date in some software (e.g. R). We might anticipate this and transform the data into a more recognisable form such as 21/08/2009. A very simple way to do this is by using a replace function. In this case we select the menu for the <code>publication_date</code> field and then <code>Edit cells &gt; Transform</code>.</p>
<p><img src="/images/openrefine/transform.png" width="800px" style="display: block; margin: auto;" /></p>
<p>This produces a menu where we enter a simple GREL replace code.</p>
<p><img src="/images/openrefine/transform_replace_date.png" width="800px" style="display: block; margin: auto;" /></p>
<pre class="r"><code>replace(value, &#39;.&#39;, &#39;/&#39;)</code></pre>
<p>This simple replace code is basically the same as find and replace in Excel or Open Office. In addition, we can see the consequences of the choice in the panel before we run the command. This is extremely useful for spotting problems. For example, if attempting to split a field on a comma we may discover that there are multiple commas in a cell (see the <code>Priority Data</code> field for this). By testing the code in the panel we could then work to find a solution or edit the offending texts in the main facet panel.</p>
<p>To find other simple codes visit the <a href="https://github.com/OpenRefine/OpenRefine/wiki/Recipes">Open Refine Recipes page</a>.</p>
<p>We will now focus on extracting information from some of the columns before saving the dataset and moving on.</p>
</div>
<div id="access-additional-information" class="section level3">
<h3>Access additional information</h3>
<p>There are a range of pieces of information that are hidden in data inside columns. For example, Patentscope data does not contain a publication country field. In particular, note that Patentscope merges all publications for an application record into one dossier. So we are only seeing one record for a set of documents (in Patentscope the wider dossier for a record is accessible through the Documents section of the website). This is very helpful in reducing duplication but it is important to bear in mind that we are not seeing the wider family in our data table. However, we can work with the information at the front of the publication number in the Patentscope records using a very simple code and create a new column (as above) based on the values returned as below.</p>
<p><img src="/images/openrefine/publication_country.png" width="800px" style="display: block; margin: auto;" /></p>
<pre class="r"><code>substring(value, 0, 2)</code></pre>
<p>Note here that the code begins counting from 0 (e.g. 0, 1 = U, 2 = S). The first part of the code looks in the value field. 0 tells the code to begin counting from 0 and the 2 tells it to read the two characters from 0. We could change these values, e.g to 1 and 4 to capture only a chunk of a number.</p>
</div>
</div>
<div id="fill-blank-cells" class="section level2">
<h2>Fill blank cells</h2>
<p>Filling blank cells with a value (NA for Not Available) to prevent calculation problems with analysis tools later can be performed by selecting each column, creating a text facet, scrolling down to the bottom of the facet choosing <code>(blank)</code>, edit and then entering NA for the value.</p>
<p><img src="/images/openrefine/blank_na_facets.png" width="800px" style="display: block; margin: auto;" /></p>
<p>Note that this is somewhat time consuming (until a more rapid method is found) but has the benefit of being accurate. It is generally faster to open the file in Excel (or Open Office) and use find and replace with the find box left blank and NA in the replace field across the data table. For that reason, blank cells should not appear in the dataset you are using in this article. However, in later steps below we will be generating blank cells by splitting the applicant and inventor field. It is therefore important to know this procedure.</p>
</div>
<div id="renaming-columns" class="section level2">
<h2>Renaming columns</h2>
<p>At this stage we have a set of columns that are mixed between the original sentence case and the additions in lower case with no spaces such as <code>publication_number</code>. This is a matter of personal preference but it is generally a good idea to regularise the case of all columns to make them easy to remember. In this case we will also add the word <code>original</code> to the columns to distinguish between those created by cleaning the data and those we have created.</p>
</div>
<div id="exporting-data" class="section level2">
<h2>Exporting Data</h2>
<p>When we are happy that we have worked through the core cleaning steps it is a good idea to export the new core dataset. It is important to do this before the steps described below because it preserves a copy of the core dataset that can be used for separation (or splitting activities) on applicants, inventors, IPC etc. during the next steps. It is important that this <code>clean</code> dataset is as clean as is reasonably possible before moving on. The reason for this is that <strong><em>any noise or problems will multiply</em></strong> when we move on to the next steps. This may require a major rerun of the cleaning steps on later files created for applicants or inventors. Therefore make sure that you are happy that the data is as clean as is reasonably possible at this stage. Then choose export from the menu and the desired format (preferably <code>.csv</code> or <code>.tab</code> if using analytics tools later).</p>
<p><img src="/images/openrefine/export_core.png" width="800px" style="display: block; margin: auto;" /></p>
</div>
<div id="splitting-applicants" class="section level2">
<h2>Splitting Applicants</h2>
<p>This article was inspired by a <a href="http://www.patinformatics.com/blog/patent-assignee-cleanup-using-google-refine-open-refine-text-facets-and-clustering/">very useful tutorial</a> on cleaning assignee names with Google Refine by Anthony Trippe. Anthony is also the author of the forthcoming <a href="http://www.wipo.int/patentscope/en/programs/patent_landscapes/">WIPO Guidelines for Preparing Patent Landscape Reports</a> and the <a href="http://www.patinformatics.com">Patentinformatics LLC</a> website has played a pioneering role in promoting patent analytics. We will take this example forward using the our sample pizza patent dataset so that it can be visualised in a range of tools. If you have not done so already, you can download the dataset <a href="https://github.com/poldham/opensource-patent-analytics/blob/master/2_datasets/pizza_medium/pizza_medium.csv?raw=true">here</a>.</p>
<p>We actually have two options here and we will go through them so that you can work out your needs in a particular situation. Note that you can use Undo in Google Refine to go back to the point immediately before you tested these approaches. However, if you have followed the data cleaning steps above, make sure that you have already exported a copy of the main dataset.</p>
<div id="situation-1---first-applicants" class="section level3">
<h3>Situation 1 - First Applicants</h3>
<p>As discussed by Anthony Tripp we could split the applicant column into separate columns by choosing, <code>Applicants &gt; Edit column &gt; Split into several columns</code>.</p>
<p><img src="/images/openrefine/split_applicants_columns.png" width="800px" style="display: block; margin: auto;" /></p>
<p>We then need to select the separator. In this case (and normally with patent data), it is <code>;</code>.</p>
<p><img src="/images/openrefine/split_selectseparator.png" width="800px" style="display: block; margin: auto;" /></p>
<p>This will produce a set of 18 columns.</p>
<p><img src="/images/openrefine/split_columns.png" width="800px" style="display: block; margin: auto;" /></p>
<p>At this point, we could begin the clustering process to start cleaning the names that is discussed in situation 2. However, the disadvantage with this is that with this size of dataset we would need to do this 18 times in the absence of an easy way of combining the columns into a single column (applicants) with a name on each row. We might want to use this approach in circumstances where we are not focusing on the applicants and are happy to accept the first name in the list as the first applicant. In that case we would simply be reducing the applicant field to one applicant. Bear in mind that the first applicant listed in the series of names may not always be the first applicant as listed on an application and may not be an organisation name. Bearing these caveats in mind, we might also use this approach to reduce the concatenated inventors field to one inventor. For general purposes that would be clean and simple for visualisation purposes.</p>
<p>However, if we wanted to perform detailed applicant analysis for an area of technology, we would need to adopt a different approach.</p>
</div>
<div id="situation-2---all-applicants" class="section level3">
<h3>Situation 2 - All Applicants</h3>
<p>One of the real strengths of Open Refine is that it is very easy to separate applicant and inventor names into individual rows. Instead of choosing Edit column we now choose <code>Edit cells</code> and then <code>split multi-valued cells</code>.</p>
<p><img src="/images/openrefine/split_multivaluedcells.png" width="800px" style="display: block; margin: auto;" /></p>
<p>In the pop up menu choose <code>;</code> as the separator rather than the default comma.</p>
<p>We now have a dataset with 15,884 rows as we can see below.</p>
<p><img src="/images/openrefine/split_multivaluedcells2.png" width="800px" style="display: block; margin: auto;" /></p>
<p>The advantage of this is that all our individual applicant names are now in a single column. However, note that the rest of the data has not been copied to the new rows. We will come back to this but as a precaution it is sensible to fill down on the publication number column as the key that links the individual applicants to the record. So let’s do that for peace of mind by selecting <code>publication number &gt; edit cells &gt; fill down</code>.</p>
<p><img src="/images/openrefine/split_filldown.png" width="800px" style="display: block; margin: auto;" /></p>
<p>We should now have a column filled with the publication number values for each applicant as our key. Note here that there is a need for caution in using <code>fill down</code> in Open Refine as discussed in detail <a href="http://googlerefine.blogspot.co.uk/2012/03/fill-down-right-and-secure-way.html">here</a>. Basically, fill down is not performed by record, it simply fills down. That can mean that data becomes mixed up. This is another reason why it is important to fill blank values with NA either before starting work in Open Refine or as one of the initial clean up steps. Using NA early on will help prevent refine from filling down blank cells with the values of another record.</p>
<p>If you have not already done so above to assist the clean up process, and as general good practice, transform the mixed case in the applicants field to a single case type. To do that select <code>Applicants &gt; Edit Cells &gt; Common Transformations &gt; To titlecase</code>.</p>
<p><img src="/images/openrefine/applicants_titlecase.png" width="800px" style="display: block; margin: auto;" /></p>
<p>We now move back to the applicants and select <code>Facet &gt; Text Facet</code>.</p>
<p><img src="/images/openrefine/applicants_textfacet.png" width="800px" style="display: block; margin: auto;" /></p>
<p>What we will see (with Applicants moved to the first column by selecting <code>Applicants &gt; Edit Column &gt; Move column to beginning</code>) is a new side window with 9,368 choices.</p>
<p><img src="/images/openrefine/applicants1.png" width="800px" style="display: block; margin: auto;" /></p>
<p>The cluster button will trigger a set of six clean up algorithms with user choices along the way. It is well worth reading the <a href="https://github.com/OpenRefine/OpenRefine/wiki/Clustering-In-Depth">documentation</a> on these steps to decide what will best fit your needs in future. These cleaning steps proceed from the strict to the lax in terms of matching criteria. The following is a brief summary of the details provided in the documentation page:</p>
<ol style="list-style-type: decimal">
<li>Fingerprinting. This method is the least likely in the set to produce false positives (and that is particularly important for East Asian names in patent data). It involves a series of steps including removing trailing white space, using all lowercase, removing punctuation and control characters, splitting into tokens on white space, splitting and joining and normalising to ASCII.</li>
<li>N-Gram Fingerprint. This is similar but uses n-grams (a sequence of characters or multiple sequences of characters) that are chunked, sorted and rejoined and normalised to ASCII text. The documentation highlights that this can produce more false positives but is food for finding clusters missed by fingerprinting.</li>
<li>Phonetic Fingerprint. This transforms tokens into the way they are pronounced and produces different fingerprints to methods 2 &amp; 3.</li>
<li>Nearest Neighbour Methods. This is a distance method but can be very very slow.</li>
<li>Levenshtein Distance. This famous algorithm measures the minimal number of edits that are required to change one string into another (and for this reason is widely known as edit distance). Typically, this will spot typological and spelling errors not spotted by the earlier approaches.</li>
<li>PPM a particular use of Kolmogorov complexity as described in this <a href="http://arxiv.org/abs/cs/0111054">article</a> that is implemented in Open Refine as <code>Prediction by Partial Matching</code>.</li>
</ol>
<p>It is important to gain an insight into these methods because they may affect the results you receive. In particular, caution is required on East Asian names where cultural naming traditions produce a lot of false positive matches on the same name for persons who are actually distinct persons (synonyms or “lumping” in the literature). This can have very dramatic impacts on the results of patent analysis for inventor names because it will treat all persons sharing the name <code>Smith, John</code> or <code>Wang, Wei</code> as the same person, when in practice they are multiple individual people.</p>
<p>We will now walk through each algorithm to view the results.</p>
<p><img src="/images/openrefine/cluster_step1.png" width="800px" style="display: block; margin: auto;" /></p>
<p>This identifies 1187 clusters dominated by hidden characters in the applicants field (typically appearing after the name). At this stage we need to make some decisions about whether or not to accept or reject the proposed merger by checking the <code>Merge?</code> boxes.</p>
<p>This step was particularly good at producing a match on variant names and name reversals as we can see here.</p>
<p><img src="/images/openrefine/applicants2.png" width="800px" style="display: block; margin: auto;" /></p>
<p>It pays to manually inspect the data before accepting it. One important option here is to use the slider on <code>Choices in Cluster</code> to move the range up or down and then make a decision about the appropriate cut off point. Then use select all in the bottom left for results you are happy with followed by <code>Merge Selected &amp; Re-Cluster</code>. In the next step we can change the keying function dropdown to Ngram-fingerprint.</p>
<p><img src="/images/openrefine/applicants-ngramfingerprint2.png" width="800px" style="display: block; margin: auto;" /></p>
<p>This produces 98 clusters which inspection suggests are very accurate. The issues to watch out for here (and throughout) are very similar names for companies that may not be the same company (such as Ltd. and Inc.) or distinct divisions of the same company. It is also important, when working with inventor names, not to assume that the same name is the same inventor in the absence of other match criteria, or that apparently minor variations in initials (e.g. Smith, John A and Smith, John B) are the same person because they may well not be.</p>
<p>To see these potential problems in action try reducing the N-gram size to 1. At this point we see the following.</p>
<p><img src="/images/openrefine/ngram1_problems.png" width="800px" style="display: block; margin: auto;" /></p>
<p>This measure is too lax and is grouping together companies that should not be grouped. In contrast increasing the N-gram value to 3 or 4 will tighten the cluster. We will select all on N-gram 2 and proceed to the next step.</p>
<p>At this point it is worth noting that the original 9,368 clusters have been reduced to 7,875 and if we sort on the count in the main window then Google is starting to emerge as the top applicant across our set of 10,000 records.</p>
</div>
<div id="phonetic-fingerprint-metaphone-3-clustering" class="section level3">
<h3>Phonetic Fingerprint (Metaphone 3) clustering</h3>
<p>As we can see below, Metaphone 3 clustering produces 413 looser clusters with false positive matches on International Business Machines but positive matches on Cooperative Verkoop.</p>
<p><img src="/images/openrefine/applicants_metaphone3.png" width="800px" style="display: block; margin: auto;" /></p>
<p>At this point we could either manually review the 413 clusters and select as appropriate or change the settings to reduce the number of clusters using the <code>Choices in Clusters</code> slider until we see something manageable for manual review. At this stage we might also want to use the <code>browse this cluster</code> function that appears on hovering over a particular selection, to review the data (see the second entry in the image below).</p>
<p><img src="/images/openrefine/applicants_browsecluster.png" width="800px" style="display: block; margin: auto;" /></p>
<p>In this case we are attempting to ascertain whether the Korea Institute of Oriental Medicine should be grouped with the Korea Institute of Science and Technology (which appears unlikely). If we open the browser function we can review the entries for shared characteristics as possible match criteria.</p>
<p><img src="/images/openrefine/applicants_browsecluster1.png" width="800px" style="display: block; margin: auto;" /></p>
<p>For example, if the applicants shared inventors and/or the same title we may want to record this record in the larger grouping (remembering that we have exported the original cleaned up data). Or, as is more likely, we might want to capture most members of the group and remove the Korea Institute of Oriental Medicine. However, how to do this is not at all obvious.</p>
<p>In practice, selection of items at this stage feeds into the next stage of cleaning using the Cologne-phonetic algorithm. As we can see below, this algorithm identified 271 clusters that were almost entirely clustered on the names of individuals with a limited number of accurate hits.</p>
<p><img src="/images/openrefine/applicants_cologne.png" width="800px" style="display: block; margin: auto;" /></p>
</div>
<div id="levenshtein-edit-distance" class="section level3">
<h3>Levenshtein Edit Distance</h3>
<p>The final steps in the process focus on Nearest Neighbour matches for our reduced number of clusters. Note that this may take some time to run (e.g. 10-15 minutes for the +7,000 clusters in this case). The results are displayed below</p>
<p><img src="/images/openrefine/applicants_levenshtein.png" width="800px" style="display: block; margin: auto;" /></p>
<p>In some cases the default settings matched individual names on different initials, but in the majority of cases the clusters appeared valid and were accepted. In this case particular caution is required on the names of individuals and browsing the results to check the accuracy of matches.</p>
</div>
<div id="ppm" class="section level3">
<h3>PPM</h3>
<p>The PPM step is the final logarithm but took so long that we decided to abandon it relative to the likely gains.</p>
</div>
<div id="preparing-for-export" class="section level3">
<h3>Preparing for export</h3>
<p>In practice, the cleaning process will generate a new data table for export that focuses on the characteristics of applicants. To prepare for export with the cleaned group of applicant names there will be a choice on whether to retain the publication number as the single key, or, whether to use the fill down process illustrated above across the columns of the dataset. It is important to note that caution is required in the blanket use of fill down.</p>
<p>It is also important to bear in mind that the dataset that has been created contains many more rows than the original version. Prior to exporting we would therefore suggest two steps:</p>
<ol style="list-style-type: decimal">
<li>Rerun Common transforms &gt; to title case, to regularise any names that may have been omitted in the first round and rerun trim whitespace for any spaces arising from the splitting of names.</li>
<li>Rerun facets on each column, select blank at the end of the facet panel and fill with NA. Alternatively, do this immediately following export.</li>
</ol>
</div>
</div>
<div id="round-up" class="section level2">
<h2>Round Up</h2>
<p>In this chapter we have covered the main features of basic data cleaning using Open Refine. As should now be clear, while it requires an investment in familiarisation it is a powerful tool for cleaning up small to medium sized patent datasets such as our 10,000 pizza patent records. However, a degree of patience, caution and forward planning is required to create an effective workflow using this tool. It is likely that further investments of time (such as the use of regular expressions in GREL) would improve cleaning tasks prior to analysis.</p>
<p>Open Refine is also probably the easiest to use free tool for separating and cleaning applicant and inventor names without programming knowledge. For that reason alone, while noting the caveats highlighted above, Open Refine is a very valuable tool in the open source patent analytics toolbox.</p>
</div>
<div id="useful-resources" class="section level2">
<h2>Useful Resources</h2>
<p>The <a href="http://openrefine.org">Open Refine website</a> has links to lots of useful resources including video walkthroughs</p>
<p><a href="https://github.com/OpenRefine/OpenRefine/wiki/Recipes">Open Refine Wiki Recipes</a></p>
<p><a href="http://googlerefine.blogspot.co.uk">Open Refine Tips and Tricks</a></p>
<p><a href="http://stackoverflow.com/questions/tagged/openrefine">Stack Overflow questions on Open Refine</a></p>
</div>
